import pandas as pd


df = pd.read_excel('C:/Users/peter_sinka/Box Sync/(Private) Peter Sinka/Sales OPS/SFDC/Implemented Products/Purchased products export.xlsx',sheetname=1)

# Set Product and Family as indices to keep them when removing colum
df = df.set_index(['Product', 'Family'])

client_df = pd.read_excel('C:/Users/peter_sinka/Box Sync/(Private) Peter Sinka/Sales OPS/SFDC/Implemented Products/Purchased products export.xlsx',sheetname=2)

# Get a unique list of clients
client_list = client_df['Account Name: Account Name'].unique()

########### Note that Excel pivot table in not case sensitive, so some manual celanup is required.
# Note OTC Clearing Comder Chile/OTC Clearing COMDER Chile needs to be duplicated in the spreadsheet.

for client in client_list:
    # bt_df is the temporary DF with the actual clients rows from the big dataframe.
    bt_df = client_df[client_df['Account Name: Account Name'] == client]
    # Create a list with the Asset class columns
    asset_columns = bt_df['Drawloop_Product_Name_Formula'][bt_df['Drawloop_Product_Family_Formula'] == 'Asset Class']
    asset_columns = asset_columns.tolist()
    # Create the output df and keep only the asset class columns that are needed.
    output_df = df[asset_columns]
    # Create a list of Modules, Pankages and Interfaces needed to be kept.
    module_rows = bt_df[(bt_df['Drawloop_Product_Family_Formula'] == 'Module') | (bt_df['Drawloop_Product_Family_Formula'] == 'Package')| (bt_df['Drawloop_Product_Family_Formula'] == 'Interface')]
    module_rows = module_rows['Drawloop_Product_Name_Formula']
    module_rows = module_rows.tolist()
    # Reset indices and keep only ter required rows from the output files.
    output_df = output_df.reset_index()
    output_df = output_df[output_df ['Product'].isin(module_rows)]
    # Setting index column name as the client name.
    output_df.index.name = client
    # Print to excel
    output_df.to_excel('C:/Users/peter_sinka/Box Sync/(Private) Peter Sinka/Sales OPS/SFDC/Implemented Products/Output excels/{}.xlsx'.format(client))
